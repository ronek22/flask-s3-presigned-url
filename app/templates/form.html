{% extends 'base.html' %} {% block content %}
<section class="hero is-danger box">
  <div class="hero-body">
    <h1 class="title">S3 Upload Form</h1>
    <h2 class="subtitle">
      Select file and upload to S3
    </h2>

    <form method="POST" action='/s3' enctype="multipart/form-data" class="container box">
      {{ form.hidden_tag() }}
      <div class="file has-name is-boxed is-fullwidth has-text-centered">
        <label class="file-label">
          <input class="file-input" type="file" name="file" required/>
          <span class="file-cta">
            <span class="file-icon">
              <i class="fas fa-upload"></i>
            </span>
            <span class="file-label"> Choose a fileâ€¦ </span>
          </span>
          <span class="file-name">No file selected</span>
        </label>
      </div>
    
      <div class="field mt-5">
        <button type="submit" class="button is-success is-fullwidth">Upload</button>
      </div>
    </form>
  </div>

</section>
<section class="hero is-info box">
  <div class="hero-body">
    <h1 class="title">S3 Objects</h1>
    <h2 class="subtitle">
      List all object in {{ bucket }}
    </h2>
    <div class="box mt-5">
      
    <table class="table is-fullwidth">
      <thead>
        <tr>
          <th>Key</th>
          <th>Storage Class</th>
          <th>Last Modified</th>
          <th>Size</th>
        </tr>
      </thead>
      <tbody>
        {% for object, url in object_list %}
          <tr>
            <td><a href="{{url}}">{{object.key}}</a></td>
            <td>{{object.storage_class}}</td>
            <td>{{object.last_modified}}</td>
            <td>{{'%0.2f'|format(object.size / 1000)}} kB</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  </div>



</section>

</div>



{% endblock %}

{% block scripts %}
document.addEventListener('DOMContentLoaded', () => {
    // 1. Display file name when select file
    let fileInputs = document.querySelectorAll('.file.has-name')
    for (let fileInput of fileInputs) {
      let input = fileInput.querySelector('.file-input')
      let name = fileInput.querySelector('.file-name')
      input.addEventListener('change', () => {
        let files = input.files
        if (files.length === 0) {
          name.innerText = 'No file selected'
        } else {
          name.innerText = files[0].name
        }
      })
    }
  
    // 2. Remove file name when form reset
    let forms = document.getElementsByTagName('form')
    for (let form of forms) {
      form.addEventListener('reset', () => {
        console.log('a')
        let names = form.querySelectorAll('.file-name')
        for (let name of names) {
          name.innerText = 'No file selected'
        }
      })
    }
  })
{% endblock %}
